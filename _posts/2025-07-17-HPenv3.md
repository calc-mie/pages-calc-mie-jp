---
layout: post
title: "計算研究会HPの環境について@2025"
author: "85yago"
---

## 2024年度版から変わったこと

[このPR](https://github.com/calc-mie/pages-calc-mie-jp/pull/4)でやったことを書きます。

### そもそもvscodeから開発できない

ページ内容を更新しようとcloneしコンテナを立ち上げると、エラーで終了します。

大体は「バージョンがどうのこうの」というエラーだったので、諸々のバージョンを雑に上げていきます。

docker imageのバージョンはすぐに上げられたのですが、`Gemfile.lock`があるのにエラーを吐いているruby周りはよくわかりません。
エラーを斜め読みしていた限り、imageのバージョンを上げたことでgemの何かしらと相性が悪くなったんだろうと思います。

そこで`Gemfile.lock`を削除し、ついでに`Gemfile`で指定しているgithub-pagesのバージョンを上げ、最後に`bundler install`でライブラリを入れ直します。

これですんなりと動きました。

### jekyllの自動更新が止まらない

`index.md`を更新して保存すると、ページの自動更新が無限ループしています。

ログを見ると、`_site`フォルダ内の更新を検出してしまい、`_site`の中へ記事をレンダリングし直したものを書き込み、再び更新を検出し……という状態に陥っていました。

そこで[jekyllのオプション](https://jekyllrb.com/docs/configuration/options/)を眺めると、`exclude`がありました。

以前は`_site`はデフォルトで監視対象外だったような気がするのですが、ともかく、これを`_config.yml`に書けば自動更新の無限ループが止まりました。

### おまけ

imageのバージョンを上げ`bundler install`を一旦コメントアウトすると、コンテナは建つもののすぐに落ちてしまいます。

`compose.yml`記載の`command`が動いていないため、コンテナが起動し続ける理由がなくなり終了していたようです。

いつもは`command`にワンライナーでsleepをfor文でぶん回すのですが、どうやら`tty: true`だけでいい感じに接続が維持できるようでした。

## おわり

割とさくっと終わりました。

古い記事を眺めていたら数式のレンダリングができていないことに気づきました、気が向いたら修正します。[Jektex](https://github.com/yagarea/jektex)なるものを見つけたので、これを試すつもりです。
